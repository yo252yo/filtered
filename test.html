<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="coinFlipContainer"></div>

    <script>
        function drawCoinFlip(p) {
            const container = document.getElementById('coinFlipContainer');
            container.innerHTML = "";
            container.style.visibility = "visible";

            const rectangle = document.createElement('div');
            rectangle.classList.add('rectangle');

            const greenPart = document.createElement('div');
            greenPart.style.backgroundColor = "green";
            greenPart.style.width = `${p * 100}%`;

            const redPart = document.createElement('div');
            redPart.style.backgroundColor = "red";
            redPart.style.width = `${(1 - p) * 100}%`;

            const cursor = document.createElement('div');
            cursor.id = "cursor";
            cursor.classList.add('cursor');

            rectangle.appendChild(greenPart);
            rectangle.appendChild(redPart);
            rectangle.appendChild(cursor);
            container.appendChild(rectangle);
        }

        function animateCoinFlip(p) {
            const animationDuration = 2000;
            const rectangleWidth = 200;
            const interval = 10;
            const cursor = document.getElementById("cursor");

            let position = Math.floor(Math.random() * rectangleWidth);
            let step = 1 + Math.floor(Math.random() * 4);
            if (Math.random() < 0.5) {
                step *= -1;
            }


            const intervalId = setInterval(() => {
                position += step;

                if (position > rectangleWidth) {
                    step *= -1;
                    position = rectangleWidth;
                } else if (position < 0) {
                    step *= -1;
                    position = 0;
                }

                cursor.style.left = `${position}px`;
            }, interval);


            var animationDelay = 2000 + Math.floor(Math.random() * 2000);
            setTimeout(() => { step /= 2; }, animationDelay - 1000);
            setTimeout(() => { step /= 2; }, animationDelay - 500);
            setTimeout(() => {
                clearInterval(intervalId); // Stop the interval
                let r = position / rectangleWidth;

                var sfw = new Audio();
                sfw.volume = 0.9;
                if (r <= p) {
                    sfw.src = `W.mp3`;
                    console.log(`GREEN`);
                } else {
                    sfw.src = `L.mp3`;
                    console.log(`RED`);
                }
                sfw.play();

                setTimeout(() => {
                    document.getElementById('coinFlipContainer').style.visibility = "hidden";
                }, 1000);
            }, animationDelay);
        }

        // Example usage: Draw a rectangle with 30% green and 70% red
        drawCoinFlip(0.3);
        animateCoinFlip(0.3);
    </script>
</body>

</html>